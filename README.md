# Targetbot — этап 1: скелет воркера

Репозиторий очищен и разворачивается заново для проекта «CI → GitHub → Cloudflare Workers → Telegram-бот отчётов по рекламе Meta». На текущем этапе добавлен минимальный каркас с основными маршрутами и проверками окружения.

## Что уже сделано
- Базовый воркер (`src/index.js`) с маршрутами `/health`, `/`, `/tg`, `/fb_auth`, `/fb_cb`, `/fb_debug`, `/p/{code}` и заглушками для дальнейшей доработки.
- Проверка обязательных переменных окружения и отладочная HTML-страница для `/fb_debug`.
- Заготовка редиректа на OAuth Meta (`/fb_auth`) и базовая валидация вебхука Telegram.
- Конфигурация Wrangler (`wrangler.toml`) с кроном, включённой Node.js-совместимостью и плейсхолдерами KV привязок.
- Сценарии npm (`npm run dev`, `npm run deploy`) и GitHub Actions workflow для автоматического деплоя через Wrangler.

## Что нужно сделать дальше
1. **Заполнить реальные Namespace ID** для всех KV в `wrangler.toml` (REPORTS_NAMESPACE, BILLING_NAMESPACE, LOGS_NAMESPACE, DB).
2. **Настроить переменные окружения** на стороне Cloudflare: `BOT_TOKEN`, `ADMIN_IDS`, `FB_APP_ID`, `FB_APP_SECRET`, `DEFAULT_TZ`, `WORKER_URL`, `FB_LONG_TOKEN` (опционально), `GS_WEBHOOK` (опционально).
3. **Реализовать обработчик Telegram**: команды `/start`, `/help`, `/register`, `/admin`, `/report`, `/digest`, callback-кнопки и сохранение состояния в KV.
4. **Добавить работу с Meta OAuth** в `/fb_cb`: обмен кода на токен, обогащение данных аккаунтов и сохранение в KV.
5. **Собрать проекты и расписания**: CRUD для `project:<code>`, автопаузы, алерты, автоотчёты, архивация HTML/CSV.
6. **Реализовать клиентский портал `/p/{code}?sig=...`** с HTML-дашбордом и управлением сигнатурами.
7. **Заполнить README** подробностями по настройке, CI/CD и эксплуатации по мере добавления функциональности.

Переходите к следующим этапам постепенно, проверяя работоспособность каждого блока командой `npm run dev` и тестовым деплоем `npm run deploy` (при готовности секретов).
