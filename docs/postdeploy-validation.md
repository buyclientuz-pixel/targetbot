# Постдеплойная валидация TargetBot

Этот чек-лист помогает убедиться, что воркер, Telegram-бот и веб-портал корректно работают после выката. Его можно запускать автоматически с помощью `npm run validate:postdeploy` или выполнять вручную, отмечая результаты в таблице ниже.

## 1. Подготовка

| Шаг | Статус | Комментарий |
| --- | --- | --- |
| Заданы переменные `WORKER_URL`, `ADMIN_KEY`, `BOT_TOKEN` |  |  |
| Список проектов доступен (ENV `PROJECTS` или R2 `reports/projects.json`) |  |  |
| Заполнены секреты Facebook (`FB_APP_ID`, `FB_APP_SECRET`) |  |  |

## 2. Скрипт быстрой проверки

Запустите:

```bash
npm run validate:postdeploy
```

Скрипт проверит ключевые маршруты (`/health`, `/api/ping`, `/portal/:id`, `/api/admin`, `/manage/telegram/webhook`) и сообщит о предупреждениях или ошибках. Если отсутствуют обязательные переменные окружения, тесты будут пропущены с пояснением.

## 3. Ручная проверка Telegram

| Команда | Ожидаемый результат | Статус | Комментарий |
| --- | --- | --- | --- |
| `/start` | Приветственное сообщение и подсказка по командам |  |  |
| `/report` | Кнопки с проектами, загрузка отчёта из R2 |  |  |
| `/admin` (для администратора) | Главное меню администратора с разделами |  |  |
| Кнопки админ-меню | Обновление отчётов, переключение алертов, техпанель |  |  |

## 4. Веб-портал и админка

| Раздел | Проверка | Статус | Комментарий |
| --- | --- | --- | --- |
| `/portal/:project` | Сводка проекта, ссылки на чат и кампании |  |  |
| `/portal/:project/campaigns` | Таблица кампаний, фильтры и кнопка обновления |  |  |
| `/admin?key=...` → «Facebook» | Статус токена, список аккаунтов, кнопка обновления |  |  |
| `/admin?key=...` → «Тех.панель» | Карточки хранилища, токенов, крон-задач, логи |  |  |

## 5. Мониторинг и логи

| Шаг | Описание | Статус | Комментарий |
| --- | --- | --- | --- |
| Проверить `logs/<date>.json` в R2 на наличие свежих записей |  |  |  |
| Убедиться, что `meta/system/cron-status.json` обновлён после крон-задач |  |  |  |
| Просмотреть `logs/facebook_errors/<date>.json` при ошибках токена |  |  |  |

## 6. Отчёт

После завершения проверки зафиксируйте результаты (дата, среда, кто проверял) и приложите журнал `npm run validate:postdeploy`. Если найдены отклонения — создайте задачи с приоритетом и ссылкой на соответствующий лог в R2.
