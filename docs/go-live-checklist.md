# Go-live чек-лист Targetbot

Используйте чек-лист перед запуском воркера или после крупных изменений. Каждый пункт требует статуса «выполнено» либо комментария с ответственным и сроком.

## 1. Аккаунты и доступы
- [ ] Проверены значения `BOT_TOKEN`, `FB_APP_ID`, `FB_APP_SECRET`, `CLOUDFLARE_API_TOKEN`, `CLOUDFLARE_ACCOUNT_ID` в Cloudflare Dashboard → Workers → Settings → Variables.
- [ ] Доступ к Cloudflare аккаунту подтверждён минимум у двух администраторов.
- [ ] Установлен локально `wrangler` (через `npm install`), проверена авторизация `npx wrangler whoami`.
- [ ] Зафиксирован ответственный за ведение README (обновление раздела Progress).

## 2. Подключение Meta
- [ ] Пройден OAuth по кнопке «Обновить токен» в `/admin`, редирект завершился на `/api/meta/oauth/callback`.
- [ ] `/api/meta/status` возвращает `ok: true`, `status: "valid"` и дату истечения токена.
- [ ] `/api/meta/adaccounts` выводит список кабинетов с именем, ID и валютой.
- [ ] В README отмечено, какой бизнес-аккаунт используется (см. Progress).

## 3. Telegram
- [ ] Тестовый проект привязан к чат-группе (есть `telegramChatId`).
- [ ] При создании лида через POST `/api/leads` приходит сообщение в Telegram.
- [ ] В логе Cloudflare нет ошибок `Failed to send Telegram message`.
- [ ] Администратор подтвердил доступ к чатам для проверки уведомлений.

## 4. Проекты и портал
- [ ] Создан тестовый проект через `/admin` и закреплён за пользователем.
- [ ] Проект привязан к рекламному кабинету (PATCH `/api/projects/:id`).
- [ ] `/portal/<projectId>` открывается и отображает таблицу лидов.
- [ ] Кнопка ✔ в портале обновляет статус лида без перезагрузки (PATCH `/api/leads/:id`).

## 5. Пользователи
- [ ] `/admin/users` отображает таблицу с существующими пользователями.
- [ ] GET `/api/users` возвращает актуальный список.
- [ ] PATCH `/api/users/:id` меняет роль и отображается в таблице.
- [ ] DELETE `/api/users/:id` удаляет пользователя, результат задокументирован.

## 6. Постдеплойные smoke-тесты
- [ ] Выполнены команды:
  ```bash
  curl -i https://<worker>/health
  curl -i https://<worker>/api/meta/status
  curl -i https://<worker>/api/meta/adaccounts
  curl -i https://<worker>/api/projects
  curl -i https://<worker>/api/users
  ```
- [ ] `/admin` открывается в браузере без ошибок JS.
- [ ] Лиды отображаются и обновляются на `/portal/<projectId>`.
- [ ] Ошибки Cloudflare/Graph API отсутствуют в логах за последние 15 минут.

## 7. Документация и процессы
- [ ] README обновлён (Implementation Status, Progress, ссылки на диаграммы актуальны).
- [ ] Runbook (`docs/runbook.md`) и инструкция по деплою (`docs/deployment.md`) просмотрены и при необходимости обновлены.
- [ ] Заполнен этот чек-лист (копия в Notion/issue) с датой запуска и подписью ответственного.
- [ ] При выявлении рисков заведены задачи в трекере.

## 8. Финальное подтверждение
- [ ] Команда поддержки получила инструкции по обращению в случае ошибок (Telegram/Meta контакты).
- [ ] Зафиксирована дата запуска и список каналов уведомления (чат, email и т. п.).
- [ ] Выполнен тестовый деплой `npm run deploy` в боевое окружение и получено сообщение Wrangler `Success: Finished deploying worker`.
- [ ] Руководитель проекта утвердил запуск.

Сохраняйте заполненный чек-лист рядом с логами деплоя, чтобы в будущем повторить успешный сценарий или быстро найти отклонения.
