# Dry-run деплоя TargetBot

Этот чеклист помогает прогнать сухой прогон деплоя (dry-run) перед реальным релизом Cloudflare Worker. Цель — убедиться, что код готов к публикации, инфраструктура настроена, а команда зафиксировала результаты.

## 1. Подготовка окружения
- Убедитесь, что локально установлены `wrangler`, `npm` и доступна команда `node`.
- Экспортируйте переменные окружения:
  - `CLOUDFLARE_ACCOUNT_ID`
  - `CLOUDFLARE_API_TOKEN`
- Проверьте наличие `.dev.vars` с актуальными токенами Telegram/Meta (используются только для smoke-запросов).

## 2. Запуск скрипта dry-run
Выполните:

```bash
npm run dry-run
```

Скрипт запускает линт, typecheck, тесты и `wrangler deploy --dry-run`. Если необходимо пропустить последний шаг (например, нет токена), добавьте флаг:

```bash
npm run dry-run -- --skip-deploy
```

> ⚠️ Пропуск деплоя допускается только для локальных проверок. Для полноценного dry-run деплоя необходимо выполнить все шаги.

## 3. Проверка артефактов
- Убедитесь, что `wrangler` выводит список готовящихся к загрузке файлов и не возвращает ошибок.
- Задокументируйте хеш последнего коммита и дату прогонки в `docs/incidents/dry-run-log.md` (создайте файл при первом запуске).
- Зафиксируйте вывод тестов и линтера в соответствующих карточках трекера.

## 4. Коммуникация
- Отправьте в командный чат ссылку на dry-run лог и укажите, были ли пропущены какие-либо шаги.
- Если dry-run выявил проблемы, создайте issue с чеклистом и ссылкой на лог.

## 5. Передача следующей задачи
После успешного dry-run обновите README:
- Добавьте запись в блок «Выполнено» с кратким описанием dry-run.
- Уточните следующую задачу (например, «собрать фидбек от поддержки»).

## Полезные ссылки
- [Deployment Guide](./deployment-guide.md)
- [Runbook](./runbook.md)
- [Final Verification](./final-verification.md)
